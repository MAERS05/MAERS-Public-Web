# MAERS 前端开发指南 (Frontend Development Guide)

本文档提供前端样式修改、组件定制和页面开发的完整指南。

---

## 目录

1. [全局样式修改](#1-全局样式修改)
2. [模块样式定制](#2-模块样式定制)
3. [组件开发](#3-组件开发)
4. [脚本开发](#4-脚本开发)
5. [高级特性](#5-高级特性)

---

## 1. 全局样式修改

### 1.1 主题配色

**文件**: `static-style/theme.css`

修改这里会影响**所有页面**的配色：

```css
:root {
    /* 背景色 */
    --bg-color: #0a0a0a;
    --card-bg: rgba(255, 255, 255, 0.05);
    
    /* 文字颜色 */
    --text-main: #ffffff;
    --text-sub: rgba(255, 255, 255, 0.7);
    
    /* 强调色 */
    --accent-color: #4a9eff;
    --accent-hover: #6bb0ff;
    
    /* 边框 */
    --border-color: rgba(255, 255, 255, 0.1);
}
```

**常见修改：**
- 改主题色：修改 `--accent-color`
- 改背景色：修改 `--bg-color` 和 `--card-bg`
- 改文字颜色：修改 `--text-main`

### 1.2 通用组件样式

**文件**: `static-style/components.css`

包含按钮、卡片、输入框等通用组件：

```css
/* 按钮样式 */
.btn {
    background: var(--accent-color);
    color: white;
    padding: 8px 16px;
    border-radius: 4px;
}

/* 卡片样式 */
.card {
    background: var(--card-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--border-color);
}
```

---

## 2. 模块样式定制

### 2.1 CMS 模块（笔记/文学/记录）

**页面**: `notes.html`, `literature.html`, `record.html`  
**样式**: 
- `static-style/cms-common.css` - 通用布局
- `static-style/html/notes.css` - 笔记特定样式
- `static-style/html/literature.css` - 文学特定样式

**修改示例：**

```css
/* static-style/html/literature.css */
body {
    /* 给文学页面加羊皮纸背景 */
    background-image: url('../../ui/paper-texture.png');
}

.tree-node {
    /* 自定义列表样式 */
    font-family: 'Serif';
}
```

### 2.2 相册模块

**页面**: `album.html`, `photos.html`  
**样式**:
- `static-style/gallery-common.css` - 通用样式
- `static-style/gallery-view.css` - 查看模式
- `static-style/gallery-admin.css` - 管理模式

**关键样式：**

```css
/* 瀑布流列宽 */
.masonry-column {
    width: calc(25% - 10px); /* 4列布局 */
}

/* 灯箱背景 */
#lightbox-overlay {
    background: rgba(0, 0, 0, 0.95);
}
```

### 2.3 音乐模块

**页面**: `music.html`, `admin-music.html`  
**样式**: `static-style/html/music.css`

**关键元素：**

```css
/* 黑胶唱片 */
.vinyl-record {
    width: 300px;
    height: 300px;
    border-radius: 50%;
    animation: spin 20s linear infinite;
}

/* 播放列表 */
.track-item.active {
    background: var(--accent-color);
}
```

---

## 3. 组件开发

### 3.1 使用现有组件

**按钮：**
```html
<button class="btn">普通按钮</button>
<button class="btn btn-primary">主按钮</button>
<button class="btn btn-danger">删除按钮</button>
```

**卡片：**
```html
<div class="card">
    <div class="card-header">标题</div>
    <div class="card-body">内容</div>
</div>
```

**输入框：**
```html
<input type="text" class="input" placeholder="请输入...">
<textarea class="textarea" rows="5"></textarea>
```

### 3.2 创建新组件

**步骤：**
1. 在 `static-style/components.css` 中定义样式
2. 使用 CSS 变量保持一致性
3. 考虑深色/浅色模式

**示例：**
```css
/* static-style/components.css */
.badge {
    display: inline-block;
    padding: 2px 8px;
    background: var(--accent-color);
    color: white;
    border-radius: 12px;
    font-size: 12px;
}

.badge-success { background: #28a745; }
.badge-warning { background: #ffc107; }
```

---

## 4. 脚本开发

### 4.1 命名空间规范

**所有功能必须挂载到 `MAERS` 命名空间：**

```javascript
// ❌ 错误：污染全局
function renderList() { ... }

// ✅ 正确：使用命名空间
MAERS.CMS.View = {
    renderList() { ... }
};
```

### 4.2 模块组织

**目录结构：**
```
custom/
├── album/
│   ├── album-view.js    # 相册展示逻辑
│   └── album-admin.js   # 相册管理逻辑
├── cms/
│   ├── cms-view.js      # CMS 视图
│   ├── cms-editor.js    # 编辑器
│   └── cms-drag.js      # 拖拽排序
└── music/
    ├── music-ui.js      # UI 渲染
    ├── music-player.js  # 播放控制
    └── music-state.js   # 状态管理
```

### 4.3 HTML 事件绑定

**方式一：使用命名空间（推荐）**
```html
<button onclick="MAERS.Admin.exportModules()">导出</button>
```

**方式二：通过 JS 绑定**
```javascript
document.getElementById('btn').addEventListener('click', function() {
    MAERS.Admin.exportModules();
});
```

### 4.4 使用共享工具

**位置**: `shared/utils.js`

```javascript
// 搜索功能
MAERS.Utils.Search.filterNodes(tree, "关键词");
MAERS.Utils.Search.getPinyinInitials("中文");

// 安全函数
MAERS.Utils.Security.escapeHtml(userInput);

// 工具函数
MAERS.Utils.Helpers.debounce(fn, 300);
MAERS.Utils.Helpers.formatDate(timestamp);
```

---

## 5. 高级特性

### 5.1 智能缩放系统

**代码位置**: `dynamic-style/script.js`

**功能**: 点击页面标题时界面缩小并模糊，再次点击恢复

**实现原理**:
```javascript
html.classList.add('shrink-view');  // 添加缩放类
```

```css
html.shrink-view {
    transform: scale(0.9);
    filter: blur(2px);
}
```

### 5.2 动态换肤

**代码位置**: `dynamic-style/style-injector.js`  
**配置文件**: `dynamic-style/modules.json`

**使用方式**:
```json
{
  "title": "笔记(赛博版)",
  "url": "notes.html?module=cyberpunk",
  "style": "static-style/html/notes-cyberpunk.css"
}
```

访问 `notes.html?module=cyberpunk` 会自动加载指定的 CSS。

### 5.3 自动深色/浅色模式

**代码位置**: `dynamic-style/script.js`

**功能**: 根据时间段（默认 07:00-19:00）自动切换模式

**配置**:
- 首页左上角 `M/A` 按钮切换手动/自动模式
- 右键按钮可配置时间段

---

## 6. 响应式设计

**文件**: `static-style/responsive.css`

**断点定义**:
```css
/* 平板 */
@media (max-width: 1024px) {
    .masonry-column {
        width: calc(50% - 10px); /* 2列 */
    }
}

/* 手机 */
@media (max-width: 768px) {
    .masonry-column {
        width: 100%; /* 1列 */
    }
}
```

---

## 7. 常见问题

### Q: 修改 CSS 后没生效？

**解决方案**:
1. 强制刷新：`Ctrl + F5`
2. 清除浏览器缓存
3. 检查 CSS 选择器优先级

### Q: 如何查看当前加载的样式文件？

**步骤**:
1. 打开浏览器开发者工具 (`F12`)
2. 切换到 `Sources` 或 `Network` 标签
3. 查看加载的 CSS 文件列表

### Q: 如何调试 JavaScript？

**步骤**:
1. 在代码中添加 `console.log()`
2. 打开浏览器控制台 (`F12` → `Console`)
3. 查看输出信息

---

## 8. 开发工作流

### 8.1 样式修改流程
```
1. 定位文件 → 2. 修改 CSS → 3. 保存文件 → 4. 刷新浏览器
```

### 8.2 组件开发流程
```
1. 设计样式 → 2. 定义 CSS 类 → 3. 编写 HTML → 4. 绑定事件
```

### 8.3 模块开发流程
```
1. 创建 custom/[模块]/ 目录
2. 编写 [模块]-view.js（视图）
3. 编写 [模块]-admin.js（管理）
4. 在 HTML 中引入脚本
5. 注册到 modules.json
```

---

**最后更新**: 2026-01-17  
**版本**: v2.7（目录结构重构后）
