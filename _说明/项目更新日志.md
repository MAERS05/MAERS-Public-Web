# MAERS 项目更新日志 (Changelog)

## [v5.0] - 2026-02-12
### 🚀 架构深度解耦与交互全量升级
- **CMS 标签系统 3.0 & 后端包化**:
    - **拆分 `cms.py`**: 将两千行的臃肿脚本拆分为 `cms_nodes.py`, `cms_tags.py`, `cms_other_tags.py`。
    - **职责分离**: 实现了“节点逻辑”、“基础标签库”与“标签工具函数”的物理隔离。
    - **逻辑解耦**: 标签配置独立存储于 `data/tags/` 下的 JSON 文件，与内容树分离。
- **前端标签抽屉重构 (Tag Drawer Modularization)**:
    - **三层架构**: `cms-tags-drawer.module.js` 拆分为 `Drawer` (核心控制器), `Render` (UI 生成) 和 `UI` (交互菜单)。
    - **交互一致性**: 侧边栏内部排序算法现已与卡片标签排序完全对齐（插入目标后方），消除了认知冲突。
    - **保存条优化**: 修复了即时保存操作（重命名/删除）后保存条误跳的 Bug。
- **图像渲染架构重构**:
    - **Native Lazy Loading**: 全站废弃 JS 模拟的懒加载方案。
    - **语义化标签**: 废弃 `div.background-image` 方案，改用 `<img>` 标签。
- **原子化通知系统**:
    - **反馈解耦**: 将原本聚合的“保存成功”通知拆解为原子化的独立消息。

## [v4.6] - 2026-02-12
### 🚀 增强与重构 (Enhancements & Refactoring)
- **标签存储架构迁移**: 彻底废弃数据库 `_TAG_CONFIG` 节点。标签分类配置全面迁移至 `data/tags/` 下的 JSON 文件（如 `cms-notes-tag-categories.json`）。
    - **逻辑解耦**: 标签配置与内容树物理隔离，支持更细粒度版本控制。
    - **性能优化**: 减少数据库大字段读取，提升侧边栏初始化速度。
- **排序交互可见性修复**: 修复了“文学”、“游戏”、“随记”模块在排序时不显示序号的问题。
    - **CSS 优化**: 精细化伪元素覆盖策略，确保 `.is-selected` 状态下的序号徽章强制显示。
- **数据管理工具增强**:
    - `wipe-data.py`: 新增对 `data/tags/` 目录的清理逻辑，并标准化了树状 JSON 的初始结构为 `{"root": []}`，防止前端解析报错。
- **Bug 修复**: 解决了 CMS 后端在执行添加节点操作时未正确返回状态导致 `400 Bad Request` 的回归问题。

## [v4.5] - 2026-02-12
### 🚀 核心：CMS 全量文件驱动重构 (File-based Storage Transition)
- **物理架构重构**: 彻底告别 SQLite 存储正文模式。正文全面转为 `data/<module>/*.md` 文件存储。

## 📋 目录 (Index)

- [[v5.0] - 2026-02-12 性能与体验突破 / 标签 3.0](#v50---2026-02-12)
- [[v4.5] - 2026-02-12 CMS 全量文件驱动重构](#v45---2026-02-12)
- [[v4.0] - 2026-02-10 文档同步 / 架构对齐](#2026-02-10)
- [[v3.4] - 2026-02-06 数据加载统一化 / 文学 Flow 2.0](#2026-02-06)
- [[v3.3] - 2026-02-05 SVG 图标与基础设施扁平化](#2026-02-05-part-2)
- [[v3.2] - 2026-02-04 快速访问与智能导航](#2026-02-04)

## [v4.0] - 2026-02-10

### 🔧 修复与优化 (Fixes & Optimization)
- **Photos 模块标签系统修复**:
    - **API 补全**: 后端新增 `/api/photos/update_tags` 接口，支持对单张图片的标签进行增量更新。
    - **前端适配器增强**: `photos-cms-adapter.module.js` 实现了 `updateNodeTags` 方法，对接新 API 并同步更新本地缓存，实现了标签管理的即时反馈。
    - **权限隔离**: 修复了访客端 (`photos.html`) 意外继承管理员权限 (`IS_ADMIN: true`) 的问题，强制将其锁定为 `false`，确保只有管理端能看到编辑 UI。

### 📚 文档同步 (Documentation Sync)
- **文件功能说明 (File Functions)**:
    - 补充了 `tag-interactions.module.js` 和 `cms-tags-admin.module.js` 的描述。
    - 修正了 `cms-admin.module.js` 的物理路径指向 (`viewer/`)。
    - 新增了 `shared/namespace.module.js` 和 `shared/templates.module.js` 的基础设施说明。
    - 细化了 `cms-render` 作为 facade 及其子模块 (`render/`) 的结构描述。
- **架构决策记录 (ADR)**:
    - 新增 **[ADR-026] 客户端模板引擎**: 记录了引入 `<template>` 标签替代字符串拼接的决策。
    - 新增 **[ADR-027] 显式命名空间初始化**: 记录了 `shared/namespace.module.js` 的架构价值。

### 🚀 新功能与特性 (New Features)
- **Space 模块 (The Space)**:
    - 新增 `space.html` (访客端) 与 `admin-space.html` (管理端)。
    - 实现了基于 `space-tree.json` 的多维数据展示，支持标签筛选与搜索。
    - **管理端集成**: 继承 CMS 核心逻辑，支持卡片式管理（编辑、删除、排序）。
- **后台管理门户 (Admin Portal)**:
    - 新增 `admin-portal.html` 作为统一管理入口。
    - 实现了模块化管理 (`admin-portal.module.js`)，支持动态添加/编辑/删除子系统模块。
    - **自动页面创建**: 添加新模块时，若 URL 为 `.html` 且不存在，会自动调用 API 创建物理文件。
- **网站引导 (Site Guide)**:
    - 新增 `custom/index/viewer/site-guide.js`，实现了首页视频引导弹窗。
    - 样式独立于 `static-style/site-guide.css`。

### ⚡ 体验优化 (UX Improvements)
- **面包屑导航 (Breadcrumb 2.0)**:
    - 重构 `cms-render-nav.module.js`，实现了 **全量筛选视图遮罩 (Breadcrumb Overlay)**。
    - 当处于搜索或筛选状态时，面包屑会自动转换为 Filter 视图，清晰展示当前过滤条件。
- **标签管理 (Tag Management)**:
    - 优化了 `cms-tags.module.js` 与 `tag-interactions.module.js`。
    - 实现了右键菜单（重命名、删除、排序）及标签拖拽排序功能。
- **滚动条美化 (Scrollbar)**:
    - 在 `style.css` 中实现了全局统一的自定义滚动条样式 (`.photo-grid`, `.folder-grid` 等)。
    - 支持深色/浅色模式自适应。

### 🖼️ Photos 模块重构 (Photos Module Refactor)
- **前后端完全分离 (Separation of Concerns)**:
    - 将 `main.module.js` (访客) 与 `admin-main.module.js` (管理) 拆分，通过 `modules.json` 或 HTML 入口独立加载。
    - **CMS 适配器 (Photos CMS Adapter)**: 引入 `photos-cms-adapter.module.js`，通过模拟 CMS 的 State/Controller 接口，使图库模块能零成本复用 CMS 强大的标签筛选系统 (`cms-tags.module.js`).
    - **数据加载标准化**: 废弃旧版 JS 配置，改为 `fetch('data/photos-data.json')` 统一加载模式。
- **管理功能增强 (Admin Enhancement)**:
    - **批量管理**: 复用核心 `BatchItemManager`，支持多选、拖拽排序、批量删除。
    - **标签系统**: 实现了与 Space/CMS 一致的标签管理体验（右键菜单、拖拽归类）。

## [v3.4] - 2026-02-06

### 🗃️ 数据加载统一化重构 (Unified Data Loading Refactor)
- **Album 模块重构 (Album Module)**:
    - 废弃并删除 `custom/album/viewer/album-config.module.js`，该模块通过 `window.CATEGORY_CONFIG` 全局变量暴露数据。
    - 前端 (`album/main.module.js`, `photos/viewer/photos-view.module.js`, `album/admin/album-admin.module.js`) 改用 `fetch('data/album-config.json')` 动态加载。
    - 后端 (`_studio/config.py`) 移除 `ALBUM_CONFIG_JS` 配置，`_studio/services/album.py` 仅操作 JSON 文件。
    - `_studio/wipe-data.py` 清理逻辑同步更新，不再重置已删除的 JS 文件。
- **Music 模块清理 (Music Module Cleanup)**:
    - 后端 (`_studio/config.py`) 移除 `MUSIC_DATA_JS` 配置。
    - `_studio/services/music.py` 移除对 `music-data.js` 的生成逻辑，统一使用 `music-data.json`。
- **架构一致性 (Architecture Consistency)**:
    - 全站数据加载现已统一为 `fetch()` + JSON 模式，符合 ADR-009 (统一数据交换格式为 JSON) 的架构决策。
    - 消除了"前端请求 JSON 但后端生成 JS"的冗余和不一致问题。

### 📚 文学 Flow 引擎 2.0 (Literature Flow 2.0)
- **物理间距死锁 (Physical Spacing Lock)**:
    - 废弃了“百分比均分”算法，改用“绝对间距”模式。书籍间距强制锁定为 15px（可配置），解决了在特定分辨率（如 770px-1270px）下书籍重叠的问题。
- **动态离屏跑道 (Dynamic Off-screen Runway)**:
    - 引入了自适应 `boundaryMargin` 计算。系统会根据屏幕宽度自动拉长“转弯路径”，确保书籍在转弯前彻底消失在视口外，解决了窄屏模式下书籍“提前掉头”的视觉 Bug。
- **稳定随机映射 (Stable Randomized Mapping)**:
    - **散落重复 (Scattered Repetition)**: 当书籍数量不足以填满回路时，系统不再顺序重复前几本书，而是通过 Fisher-Yates 算法生成随机洗牌映射表，将重复项均匀散落在不同排。
    - **身份锚定 (Identity Anchoring)**: DOM 元素与物理槽位强绑定。通过 `((i % n) + n) % n` 算法彻底消除了高速流动中书籍“闪烁/随机变脸”的问题。
- **回路取整对齐 (Loop Alignment)**:
    - 强制总回路长度为间距的整数倍，保证无线循环在衔接处严丝合缝。
- **参数化自适应 (Parametric Self-Adaptation)**:
    - 系统实现了高度解耦。开发者现在可以随意更改书籍数量或间距数值，引擎会自动重新计算所有的 3D 路径、随机映射和离屏缓冲区，实现“改一动全”的自动化适配。

### 💾 CMS 管理端保存逻辑重构 (CMS Save Bar Refactor)
- **中央调度模式 (Centralized Coordination)**:
    - 废弃了各子模块（文件/标签）独立初始化 `SaveButton` 的做法。现在由 `admin-main.module.js` 统一接管保存条的初始化与状态监听。
    - **全局脏检查 (CheckGlobalDirty)**: 引入了跨模块的“脏检查”聚合器。只有当文件修改或标签变动中至少有一个处于 `isDirty` 状态时，全局保存条才会显示。
- **管理器自治权受控 (Manager Control)**:
    - 为 `BatchItemManager` 引入了 `autoSaveBar: false` 配置项，允许 CMS 模块禁用管理器的本地保存条行为，完全移交中央调度器指挥，彻底解决了保存条闪烁和逻辑冲突问题。

### 🏷️ 标签管理系统 2.0 (Tag Management 2.0)
- **批量点选交互 (Batch Selection)**:
    - 抛弃了隐晦的“长按/拖拽”手势，改用显性的“点选小球”模式。
    - **一键搬家 (Click-to-Move)**: 用户点选若干标签后，直接点击目标分类标题，选中的标签会“瞬间移动”到该分类下。
- **布局优化 (Layout Refinement)**:
    - 标签列表从“横向挤压”改为“纵向列表”，极大提升了长标签的阅读性。
    - **智能裁剪**: 长标签自动应用 `ellipsis`（省略号）并支持 Hover 查看完整全名的 `title` 提示。
- **自动导航 (Auto-Expansion & Navigation)**:
    - **精准定位**: 移动标签后，目标分类会自动展开，且视图会自动滚动至新移动的标签位置。
    - **视觉闪烁 (Flash Highlight)**: 配合短暂的青色背光闪烁，明确告知用户移入的位置。

### 🎨 交互视觉锐化 (UI/UX Sharpening)
- **白昼模式适配 (Light Mode Optimization)**:
    - 显著增强了选择球在白昼模式下的对比度（边框不透明度提升至 0.5）。
    - 确立了白昼模式下的“阶梯式”绿色反馈：鼠标悬停行时变淡绿，精准指示球体时变深绿，极大地提升了强光环境下的可操作性。
- **Toast 消息闭环 (Notification Sync)**:
    - 移除了子模块内部的冗余消息，统一由中央调度器在保存/取消动作后弹出唯一的通知，解决了“一次操作弹两个窗”的视觉污染。

### 🔧 文档更新 (Documentation)
- 在 `细节设计说明.md` 中新增第 15 章，系统性阐述了 CMS 双管理器协同工作的逻辑架构。

### 🎨 SVG 图标主题化与昼夜适配 (SVG Icon Theming & Adaption)
- **瑞士黑白对齐 (Swiss Black & White Consistency)**:
    - 确立了深色模式下图标自动变白的标准方案。针对纯黑色或深灰色设计的 SVG 图标（如 `record-icon.svg`），在黑夜模式下强制应用 `filter: invert(1)`。
- **全站图标同步 (Multi-Surface Synchronization)**:
    - **首页卡片**: 在 `index.css` 中为 Record 入口卡片添加了定向变色逻辑。
    - **空间导航**: 在 `spatial-nav.css` 中为悬浮侧边栏卡片添加了同类适配，确保全页面可见图标一致。
    - **管理后台**: 在 `admin-portal.css` 中为 backend 卡片图标添加适配，解决了“后台黑夜模式图标不可见”的问题。
    - **模块标题**: 在 `record.css` 中实现了 Records 页面标题图标的自动反转。
- **细节微调 (Visual Refinement)**:
    - **Music 模块**: 为音乐分类图标 (`music-class.svg`) 添加了 `filter: invert(0.6)` 的灰色反转，相比纯白更加柔和，符合分类导航的视觉层级。
    - **尺寸修正**: 将 `music.html` 中的耳机图标 (`music-headphone.svg`) 调整为 `1em` 比例，提升视觉平衡感。

### 🔧 架构与维护 (Maintenance)
- **文档更新**:
    - 在 `细节设计说明.md` 中新增第 14 章，专门阐述图标主题化的配置逻辑。
    - 更新了 `文件功能说明.md`，标注了各页面 CSS 中新增的主题适配职责。

### ♻️ 基础设施扁平化 (Infrastructure Flattening)
- **共享 UI 模块迁移 (Root Shared Migration)**:
    - 废弃并移除 `custom/shared/ui/` 目录，将其核心成员 `layout.module.js`, `theme.module.js`, `spatial-nav.module.js` 移至根目录 `shared/` 下。
    - **目的**: 降低模块引用深度，使 UI 基础设施作为一等公民直接服务于全站。
- **管理后台基石迁移 (Admin Core Relocation)**:
    - 将 `admin-core.module.js` 从 `custom/index/admin/` 移至 `data-manage/` 目录。
    - **目的**: 确立其作为数据管理与 UI 交互中间件的地位，不再局限于“首页管理”专有。
- **通用页面入口迁移 (Simple-Main Migration)**:
    - 将 `simple-main.module.js` 从 `custom/shared/` 移至 `shared/` 目录。
    - **目的**: 为静态页面（Me, Space, Games）提供更直观的初始化入口。

### 🔧 依赖与链路更新 (Dependency & Links)
- **全站导入路径重刷 (Path Updates)**:
    - 批量更新了全站 `.js` 和 `.html` 文件中的 import 路径。
    - **HTML 模板联动**: 更新了 `_studio/routes.py` 中的 `PAGE_TEMPLATE`，确保通过后台自动生成的新页面能正确加载 UI 基础设施。
- **文档同步**:
    - 更新了 `文件功能说明.md`, `架构决策记录.md` 等设计文档，确保文档描述与物理路径完美对齐。
- **清理**:
    - 移除已变为空目录的 `custom/shared/`。

## [v3.3] - 2026-02-05 (Part 2)

### 🛡️ 管理后台安全加固 (Admin Security & Safety)
- **删除确认流程升级 (Secure Deletion)**:
    - 废弃了脆弱的 `confirm()` 确认框。现在删除页面或相册分类时，用户必须手动输入**文件名**或**分类 ID** 才能确认执行，极大降低了误删物理文件的风险。
    - 受影响模块：`index-admin.module.js`, `album-admin.module.js`。
- **物理文件联动清理 (Physical File Sync)**:
    - **相册分类删除**: 新增“关联删除”选项。确认删除分类时，会进一步询问是否删除服务器上的物理图片目录 (`photos/*/{id}`)。如确认，后端将执行 `shutil.rmtree` 彻底清理。
    - **图片管理反馈**: 删除图片并在保存时，Toast 消息将明确提示“关联物理图片已同步粉碎”，增强操作的透明度与安全感。

### ✨ 相册管理深度增强 (Album Maintenance)
- **相册 ID 可编辑性**: 开发者现在可以直接修改相册分类的 `id`，该 ID 直接对应底层的图片文件夹路径，增强了数据修正的灵活性。
- **自动化目录初始化**: 在添加新分类时，后端服务 (`album.py`) 现在会自动在服务器上同步创建对应的 `images`, `thumbnails`, `previews` 三级物理目录，不再需要手动创建文件夹。

### 🖥️ 首页管理系统 (Index Management System)
- **卡片化配置 (Card-based Config)**:
    - 首页图标与入口现已完全实现**动态配置化**。管理员可以通过 `admin-index.html` 直接管理首页的导航卡片（对应 `data/index-cards.json`）。
    - 支持在线修改卡片标题、副标题、SVG 图标路径以及关联的模块链接。
- **模块联动 (Module Integration)**:
    - 首页管理与 `modules.json` 深度联动，支持直接配置各模块的展示风格（Style）以及对应的后端数据路径。

### 🖥️ 终端交互与回显 (Terminal DX)
- **Studio Engine 标准化日志**:
    - 全面重易后端 (`_studio`) 的打印逻辑。所有服务 (`routes`, `cms`, `photos`, `album`, `music`, `bili`) 现在均采用统一的 `[ MODULE ] 图标 描述` 格式回显。
    - **中英双语回显**: 所有操作反馈改为中英双语（例如：`[ ALBUM ] 🆕 添加新分类 | Adding new category: ...`），赋予系统一种“实验设备”般的专业交互质感。
- **启动脚本美化**: `.bat` 启动器恢复为稳定版，保持简洁的启动逻辑。

### 🧩 前端细节修正 (Frontend Consistency)
- **SVG 引用标准化**: 将 `music.html` 中遗留的内联小房子 SVG 替换为统一的 `ui/music-home.svg` 资源文件，并通过 CSS Filter 实现了完美的主题色适配。

## [v3.3] - 2026-02-05 (Part 1)

### ♻️ 架构重构 (Architecture Refactor)
- **核心模块统一 (Theme Unification)**:
    - 废弃并移除 `dynamic-style/script.module.js`，将其拖拽 (`Drag`)、缩放 (`Zoom`) 及主题切换逻辑完全整合至 `shared/theme.module.js`。
    - 实现了 `drag.css` 的自动注入机制，现在只需引入 `theme.module.js` 即可自动获得拖拽能力，大大简化了 `admin` 页面的依赖引用。
    - **Admin 页面标准化**: 所有 Admin 页面 (`admin-music`, `admin-photos`, `admin-cms`, `admin-album`) 均已切换为使用新的 `theme.module.js`，消除了代码冗余。

### 🎨 视觉与资源 (Visual & Assets)
- **图标硬编码清理 (SVG Extraction)**:
    - 识别并重构了遗留在 `admin-music.html` 和 `cms-recent.module.js` 中的硬编码 SVG 字符串和小图标。
    - 新增 `ui/music-home.svg` (音乐后台返回首页)
    - 新增 `ui/cms-history.svg` (CMS 快速访问)
    - 新增 `ui/cms-pin.svg` & `ui/cms-pin-slash.svg` (CMS 固定/取消固定)
    - **原生倾斜支持**: 将 "Pin" 图标的 45度倾斜效果直接写入 SVG 文件内部 (`transform="rotate(45, 12, 12)"`)，移除了 JS 中脆弱的 CSS `rotate` 样式。
- **布局修复**:
    - 移除了 Music Admin 标题中冗余的 `EDIT` 徽章，完美解决了左侧返回按钮被挤压换行的问题。
    - 修复了 `photos-view.module.js` 中标题渲染使用 `textContent` 导致 HTML 图标显示为源码的问题，改回 `innerHTML` 并加强了 XSS 防御意识。

### 🐛 修复 (Fixes)
- **灯箱冲突 (Lightbox Conflict)**: 修复了 `cms-lightbox.module.js` 错误拦截 Quick Access 按钮点击事件的问题（因按钮内含 `<img>`），新增了“忽略 `<button>` 内部图片”的判断逻辑。
- **数据维护工具 (Data Tools)**:
    - **中文路径支持**: `clean-data.py` 正则引擎升级，现在能正确识别和保留中文命名的图片文件（`photos/中文.jpg`），防止误删。
    - **全量重置增强**: `wipe-data.py` 新增对 `custom/` 目录下相册配置（JSON & JS）的重置逻辑，并引入 SQLite `sqlite_sequence` 重置，确保 ID 计数器彻底归零。


### 📱 移动端深度适配 (Mobile Deep Adaptation)
- **架构重组 (Architecture)**:
    - 建立 `custom/zmobile adaptation/` 专用目录，实现移动端样式与核心逻辑的物理隔离。
    - 新增 `mobile-photos.css`, `mobile-album.css`, `mobile-admin.css` 等组件级适配文件。
- **性能调优 (Performance)**:
    - **极速响应模式**: 在移动端 (`max-width: 1024px`) 强制禁用所有全局过渡动画 (`transition: none`)，消除主题切换时的渲染卡顿。
    - **去毛玻璃化**: 移动端强制移除高耗能的 `backdrop-filter` 和阴影，改用高不透明度纯色背景，显著降低 GPU 负载。
- **UI/UX 细节修正**:
    - **Index**: 修复缩放视图 (`shrink-view`) 下的内容裁剪问题；实现 Logo 颜色根据深浅主题自动反转 (CSS Filters)。
    - **Photos**: 移动端 Header 采用极简模式（隐藏标题文字，仅保留 SVG 图标），并使用实心背景防止内容透视干扰。
    - **Music**: 优化面包屑导航与跑马灯布局，在窄屏下自动换行 (`Wrap`)，防止信息重叠；新增播放列表拖拽手柄 (`⋮⋮`) 视觉提示。
    - **Literature**: 头部工具栏支持弹性换行，快速访问栏 (`Quick Access`) 改为横向滑动布局。
- **即时感知设计 (Affordance)**:
    - **S/A/M 按钮**: 新增 "Tap: Switch / Hold: Config" 明确操作指引。
    - **首页交互**: Logo 区域 hover 时显示 🔍 提示，暗示可缩放/查看。
    - **Literature 交互**: 新增 `mobile-literature.js` 独立适配脚本，将移动端触摸滑动 (`Touch Swipe`) 转换为虚拟滚轮事件，完美复刻桌面端流动翻页体验，解决了无法左右滑动阅览的问题。
    - **Photos 交互**: 新增 `mobile-photos.js` 适配脚本，使移动端用户在灯箱模式下能通过左右滑动切换图片。
    - **Book Flow 布局**: 针对移动端优化了 Flow 引擎的版面计算，将行高由 270px 压缩至 160px，确保三行书籍在手机竖屏下也能完整同屏显示，无裁剪。


## [v3.2] - 2026-02-04 (Part 2)

### ✨ 新增 (Features)
- **快速访问 (Quick Access)**：全新重构侧边栏，支持“固定访问”与“最近访问”分区，自动持久化存储。
- **图钉交互系统**：增加可交互图钉图标，支持固定/取消固定文件，具备 Hover 划线动画及深色模式适配。
- **Literature 深度集成**：支持从快速访问直接打开书籍（自动暂停 Flow 动画），并为视图切换按钮添加智能提示（Tooltip）。
- **多标签新建自动归类**：在筛选状态下新建文件，自动应用当前所有筛选标签。
- **筛选状态导航保持**：在筛选模式下进入/返回文件夹，自动在当前路径下维持筛选条件，不再重置为全量列表。
- **标签搜索自动展开**：搜索标签时，自动展开包含匹配项的父分类。

### 🐛 修复 (Fixes)
- **删除即时反馈 (Optimistic UI)**：修复筛选模式下删除文件需手动刷新的问题，改为强制立即移除 DOM 节点。
- **移动端资源缺失**：补全 `mobile-literature.css`，修复 404 报错。
- **模块引用错误**：移除 `admin-main.module.js` 中错误的 `Content` 引用。

### ♻️ 优化 (Refactor)
- **统一刷新逻辑**：重构 `refreshView`，使其根据当前视图模式（普通/筛选）智能决定刷新策略。
- **搜索作用域升级**：`Search` 模块支持基于当前文件夹路径的局部筛选。
- **相册排序重构**：重写相册排序逻辑，新增“时间倒序/正序”功能。支持解析多种格式的时间戳（包括 `20260115_..._72` 带序号高精度格式），完美解决同秒连拍图片的排序问题。
- **相册 UI 优化**：新增下拉式排序菜单 (`Dropdown Menu`)，适配深浅色模式，提升交互体验。


## [v3.2] - 2026-02-04 (Part 1)

### ✨ 新增 (Features)
- **CMS 智能导航系统**：
    - **自动定位上下文**：在搜索或标签筛选结果中点击文件时，支持自动跳转至文件所在的物理文件夹，并刷新网格视图。
    - **交互式预览确认**：在筛选模式下打开文件时，增加智能弹窗询问：“仅预览内容”或“跳转到所在目录”。
    - **全量视图遮罩**：在激活搜索或筛选时，面包屑导航栏自动显示 "All" 遮罩层，覆盖原有层级路径，明确标识“全局筛选视图”，消除用户困惑。
- **UI/UX 细节优化**：
    - **Music 模块**：优化添加按钮 (`.add-btn`) 交互体验，修复 Hover 时的颜色反转闪烁问题，统一为平滑缩放动画。
    - **Photo 模块**：统一相册头部“上传图片”与“排序”按钮的视觉风格，确保 Dark/Light 模式下的一致性。

### 🎨 视觉与交互 (Visual & Interaction)
- **SVG 全量化转型**：
    - 绝大部分 Emoji 图标（如 🗻、💿、🍸、🌿 等）已替换为专业 SVG 图标，确保在高 DPI 屏幕下的清晰度与视觉一致性。
    - **相册分类卡片**：全面采用 SVG 占位图体系，支持自定义 SVG 路径引用。
    - **管理端 UI 清理**：移除 CMS 管理端等区域的冗余 Emoji。
- **管理端交互重构**：
    - **严格撤销流程**：在 Admin 首页和 Album 管理页的弹出式编辑/新增弹窗中，实现“任一步骤取消即全程中止”的严格逻辑，防止脏数据提交。
    - **路径动态包装**：
        - **Admin 首页**：支持直接输入 SVG 路径，渲染时自动包装为 `<img>` 标签，保持 `modules.json` 数据纯净。
        - **Album 页面**：支持输入 SVG 路径自动转换为 HTML `<img>` 标签存储，并提供 `_extractSrc` 助手函数方便二次编辑。
    - **样式维护支持**：Admin 首页管理现在支持直接编辑和新增 `style` (CSS) 字段，实现页面风格的在线切换。


### 🐛 修复 (Fixes)
- **CMS 状态同步**：修复了筛选操作后面包屑状态未及时更新的 Bug（在 `Search.applyFilter` 中补充渲染调用）。
- **样式冲突**：移除了 `music-admin.css` 中与 Viewer 样式冲突的按钮 hover 规则。
