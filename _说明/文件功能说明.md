# MAERS 文件功能说明图谱

本文档提供了项目中所有关键文件的功能字典。如需修改某个功能但不知从何下手，请查阅此表。

---

## 📋 目录 (Table of Contents)

1. [根目录文件 (Root)](#1-根目录文件-root)
2. [后端核心引擎 (_studio)](#2-后端核心引擎-_studio)
3. [业务模块 (custom)](#3-业务模块-custom)
4. [关键基础设施 (shared & static-style)](#4-关键基础设施-shared--static-style)
5. [数据与配置 (data & config)](#5-数据与配置-data--config)

---

## 1. 根目录文件 (Root)

| 文件名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `index.html` | Entry | **网站首页**。展示个人主页、网站引导及 3D 地球特效。 |
| `admin-portal.html` | Entry | **后台管理门户**。统一的模块化后台管理入口。 |
| `space.html` | Entry | **空间 (Space)**。多维数据展示与收藏页。 |
| `admin-space.html` | Entry | **空间管理**。Space 数据的后台管理。 |
| `notes.html` | Entry | **笔记 (CMS)**。通用内容管理系统前端。 |
| `admin-cms.html` | Entry | **笔记管理**。CMS 内容增删改查。 |
| `literature.html` | Entry | **文学**。沉浸式阅读与 Flow 布局引擎展示页。 |
| `music.html` | Entry | **音乐**。全站音乐播放器。 |
| `admin-music.html` | Entry | **音乐管理**。歌单与音频文件管理。 |
| `photos.html` | Entry | **图库**。瀑布流摄影展示页。 |
| `admin-photos.html` | Entry | **图库管理**。图片上传与管理。 |
| `album.html` | Entry | **相册**。相册分类入口页。 |
| `admin-album.html` | Entry | **相册管理**。相册分类管理。 |
| `record.html` | Entry | **记录**。时间轴/日志类页面。 |
| `games.html` | Entry | **游戏**。静态游戏列表页，支持网格布局展示与详情查阅。 |
| `admin-games.html` | Entry | **游戏管理**。游戏条目增删改查、封面上传与标签管理。 |
| `me.html` | Entry | **关于**。个人介绍页。 |
| `maers-version-controller.js` | Service | **版本控制器**。管理前端版本号与缓存清除策略。 |
| `vercel.json` | Config | **部署配置**。Vercel 路由与重定向规则。 |

---

## 2. 后端核心引擎 (_studio)

路径：`_studio/` (Python 环境)

| 文件名 | 描述 |
| :--- | :--- |
| `server.py` | **服务器入口**。初始化原生 HTTP Server，配置静态资源路径，启动 HTTP 服务。 |
| `routes.py` | **路由控制器**。定义所有 `/api/*` 接口，接收前端请求并分发给 Service 层。 |
| `config.py` | **配置文件**。定义端口号、数据库路径、上传目录等全局常量。 |
| `open-file.py` | **文件定位**。接收文件路径参数，调用系统默认程序打开文件或所在目录。 |
| `services/cms.py` | **CMS服务**。核心逻辑引擎。处理数据库索引与物理 `.md` 文件的同步（增删改、重命名），负责**标签分类 (JSON) 的持久化管理**，并生成 JSON 快照。 |
| `services/album.py` | **分类服务**。管理相册分类、排序及目录初始化。 |
| `services/photos.py` | **相册服务**。处理图片上传、去重、物理删除及**标签增量更新**。 |
| `services/space.py` | **空间服务**。管理 Space 模块的树状结构数据与元数据集合。 |
| `services/music.py` | **音乐服务**。管理音乐元数据的持久化存储 (JSON)。 |
| `services/bili.py` | **B站服务**。解析 Bilibili 视频元数据并生成静态封面。 |
| `clean-data.py` | **资源清理**。扫描 DB 引用并清理孤儿图片及孤儿 `.md` 文档。 |
| `wipe-data.py` | **数据重置**。清库并物理销毁所有图片和 `.md` 文档。 |

---

## 3. 业务模块 (custom)

所有业务逻辑均按模块隔离，通常包含 `viewer` (访客端) 和 `admin` (管理端) 两个子目录。

### 3.1 管理门户 (admin-portal/)
| 文件名 | 路径 | 描述 |
| :--- | :--- | :--- |
| `admin-portal.module.js` | `admin/` | **门户核心**。模块加载、动态页面创建、全局入口管理。 |
| `main.module.js` | `root` | **适配入口**。初始化管理门户逻辑。 |

### 3.2 空间模块 (space/)
| 文件名 | 路径 | 描述 |
| :--- | :--- | :--- |
| `space-view.module.js` | `viewer/` | **访客主控**。加载 `space-tree.json`，集成 CMS 搜索/标签。 |
| `space-render.module.js` | `viewer/` | **渲染引擎**。负责 Space 卡片网格渲染。 |
| `space-admin.module.js` | `admin/` | **管理核心**。实现 Space 数据增删改查。 |
| `space-cms-adapter.module.js`| `admin/` | **CMS 适配器**。适配 Space 数据结构以复用 CMS 组件。 |
| `space-viewer.css` | `viewer/` | **Space 样式**。定义网格与卡片视觉。 |
| `space-admin.css` | `admin/` | **管理样式**。定义操作按钮与表单样式。 |

### 3.3 核心内容管理 (cms/)
| 文件名 | 路径 | 描述 |
| :--- | :--- | :--- |
| `main.module.js` | `root` | **访客入口**。初始化 CMS 视图的核心逻辑。 |
| `admin-main.module.js` | `root` | **管理入口**。初始化 CMS 编辑器与管理功能。 |

**访客端 (`viewer/`)**:
| 文件名 | 描述 |
| :--- | :--- |
| `cms-view.module.js` | **主视图控制器**。访客端入口。 |
| `cms-render.module.js`| **渲染 Facade**。统一渲染入口。 |
| `cms-adapter.module.js` | `root` | **[CORE] 通用适配器**。统一的标签逻辑核心，供 Space/Photos 等模块复用，消除重复代码。 |
| `render/cms-render-grid.module.js`| **网格渲染**。文件夹与文件卡片生成。 |
| `render/cms-render-nav.module.js`| **导航渲染**。面包屑、标题及**筛选视图遮罩**。 |
| `cms-search.module.js`| **搜索引擎**。前端搜索与过滤联动。 |
| `cms-tags.module.js` | **标签 Facade**。标签系统入口。 |
| `tags/cms-tags-drawer.module.js`| **标签抽屉**。侧边栏 UI 与交互。 |
| `tags/cms-tags-filter.module.js`| **标签逻辑**。筛选算法封装。 |
| `cms-recent.module.js`| **快速访问**。最近访问记录管理。 |
| `cms-lightbox.module.js`| **灯箱**。图片查看器。 |
| `cms-adapter.module.js` | **通用适配器**。[NEW] 统一的标签逻辑核心，供 Space/Photos 等模块复用，消除重复代码。 |

**管理端 (`admin/`)**:
| 文件名 | 描述 |
| :--- | :--- |
| `cms-controller.module.js`| **管理主控**。API 封装与数据交互。 |
| `cms-admin.module.js` | **UI 交互**。工具栏与批量操作逻辑 (物理位于 viewer 但逻辑属 Admin)。 |
| `cms-editor.module.js` | **编辑器**。Vditor 集成。 |
| `cms-drag.module.js` | **拖拽**。SortableJS 集成。 |
| `cms-tags-admin.module.js`| **标签管理**。标签分类持久化。 |
| `tag-interactions.module.js`| **标签交互**。右键菜单与标签拖拽。 |

### 3.4 音乐模块 (music/)
| 文件名 | 路径 | 描述 |
| :--- | :--- | :--- |
| `main.module.js` | `root` | **访客入口**。集成播放器核心与 UI。 |
| `admin-main.module.js` | `root` | **管理入口**。集成音乐管理功能。 |
| `music-player-core.module.js`| `viewer/` | **内核**。Audio 对象封装与事件发布。 |
| `music-ui.module.js` | `viewer/` | **UI**。界面交互与进度条控制。 |
| `music-render.module.js` | `viewer/` | **渲染**。歌单列表渲染。 |
| `music-state.module.js` | `viewer/` | **状态**。播放列表与模式持久化。 |
| `music-player-pip.module.js` | `viewer/` | **画中画**。悬浮窗逻辑。 |
| `music-admin.module.js` | `admin/` | **管理**。文件上传与元数据编辑。 |

### 3.5 图库与相册 (photos/ & album/)
| 文件名 | 路径 | 描述 |
| :--- | :--- | :--- |
| `main.module.js` | `photos/` | **主入口**。初始化 Photos 应用，集成 Layout、Theme 和 CMS 适配器。 |
| `admin-main.module.js` | `photos/` | **管理入口**。继承主入口逻辑，额外初始化 Admin 模块与保存按钮。 |
| `photos-view.module.js` | `photos/viewer` | **视图核心**。负责瀑布流渲染、交互事件监听及 Lightbox (灯箱) 调用。 |
| `photos-viewer.css` | `photos/viewer` | **视图样式**。定义网格布局、图片悬停特效及响应式规则。 |
| `photos-controller.module.js`| `photos/admin` | **控制器**。管理数据状态 (State)、封装 API 调用 (增删改查) 及脏检查。 |
| `photos-admin.module.js` | `photos/admin` | **管理核心**。实现图片批量选择、拖拽排序、物理删除及标签管理逻辑。 |
| `photos-cms-adapter.module.js`| `photos/admin` | **CMS 适配器**。实现 State/Controller 模拟与 `updateNodeTags` 回写逻辑，支持标签的双向同步。 |
| `photos-header-btn.css` | `photos/viewer` | **顶部按钮样式**。定义排序、筛选及上传按钮的样式。 |
| `photos-admin.css` | `photos/admin` | **管理样式**。定义拖拽占位符、选中状态及管理工具栏样式。 |
| `album-admin.module.js` | `album/admin` | **相册管理**。分类管理与封面设置。 |
| `linear-gallery.css` | `viewer` | **线性画廊**。相册列表页面样式。 |

### 3.6 文学模块 (literature/)
| 文件名 | 路径 | 描述 |
| :--- | :--- | :--- |
| `literature-view.module.js` | `viewer/` | **阅读器**。Flow 引擎初始化。 |
| `flow/` | `viewer/flow/` | **Flow 引擎**。核心排版算法与虚拟滚动。 |
| `literature-reset.css` | `viewer/` | **重置样式**。覆盖 CMS 默认样式以适配阅读体验。 |

### 3.7 游戏模块 (games/)
| 文件名 | 路径 | 描述 |
| :--- | :--- | :--- |
| `main.module.js` | `root` | **主入口**。初始化 Games 视图，集成搜索、标签过滤与 Admin 模式切换。 |
| `games.css` | `viewer/` | **游戏样式**。定义网格布局、卡片悬停效果与深色模式适配。 |
| `games-reset.css` | `viewer/` | **重置样式**。定制化 CMS 基础样式以适配游戏封面展示需求。 |

### 3.8 首页与引导 (index/)
| 文件名 | 路径 | 描述 |
| :--- | :--- | :--- |
| `site-guide.js` | `viewer/` | **网站引导**。视频弹窗逻辑。 |
| `index-3d.module.js` | `root` | **3D 地球**。首页特效。 |

### 3.8 移动端适配 (zmobile adaptation/)
| 文件名 | 描述 |
| :--- | :--- |
| `mobile-global.css` | **全局**。禁用昂贵特效，优化触屏体验。 |
| `mobile-cms.css` | **CMS**。单栏布局与触摸优化。 |
| `mobile-space.css` | **Space**。网格重排。 |
| `mobile-index.css` | **首页**。3D 特效与卡片布局移动端适配。 |
| `mobile-music.css` | **音乐**。播放器移动端布局。 |
| `mobile-photos.css` | **图库**。瀑布流列数调整。 |
| `mobile-photos.js` | **图库交互**。移动端触摸手势与点击事件适配。 |
| `mobile-album.css` | **相册**。分类列表布局。 |
| `mobile-literature.js`| **文学交互**。触摸手势适配 Flow 引擎。 |
| `mobile-admin.css` | **管理**。表单与列表移动端优化。 |
| `mobile-spatial-nav.css`| **导航**。悬浮球移动端位置与大小。 |
| `mobile-games.css` | **游戏**。强制双列布局与移动端优化。 |

---

## 4. 关键基础设施 (shared & static-style)

### 4.1 共享模块 (shared/)
| 文件名 | 描述 |
| :--- | :--- |
| `namespace.module.js` | **[CORE] 命名空间**。初始化 `window.MAERS`。 |
| `simple-main.module.js` | **通用入口**。静态页面 (Me/Games) 的轻量级初始化脚本。 |
| `templates.module.js` | **模板引擎**。基于 `<template>` 的客户端渲染。 |
| `flash-guard.js` | **[CRITICAL] 防闪烁**。同步脚本，防止 FOUC。 |
| `style-injector.module.js`| **样式注入**。动态加载模块 CSS。 |
| `module-config.module.js` | **配置中心**。模块元数据定义。 |
| `layout.module.js` | **布局**。公共 Header/Menu。 |
| `theme.module.js` | **主题 Facade**。统一主题接口。 |
| `theme-core.module.js` | **主题内核**。状态持久化与 Iframe 同步。 |
| `theme-drag.module.js` | **拖拽引擎**。全局拖拽检测。 |
| `theme-zoom.module.js` | **缩放引擎**。全站视口缩放。 |
| `spatial-nav.module.js` | **空间导航**。3D 悬浮球。 |
| `utils.module.js` | **工具库**。XSS 防护与通用函数。 |
| `toast.module.js` | **通知**。全局 Toast 单例。 |

### 4.2 全局样式 (static-style/)
| 文件名 | 描述 |
| :--- | :--- |
| `theme.css` | **主题变量**。色彩定义与深色模式。 |
| `style.css` | **全局样式**。Reset, Typography, **自定义滚动条**。 |
| `components.css` | **组件库**。按钮、输入框、卡片基础样式。 |
| `spatial-nav.css` | **导航样式**。悬浮球样式。 |
| `drag.css` | **拖拽样式**。视觉反馈。 |
| `site-guide.css` | **引导样式**。视频弹窗样式。 |
| `responsive.css` | **响应式**。定义全局断点与移动端适配基准。 |
| `splash.css` | **加载屏**。定义首屏加载动画。 |

### 4.3 管理基石 (data-manage/)
| 文件名 | 描述 |
| :--- | :--- |
| `admin-base.module.js` | **管理 Facade**。统一导出管理组件。 |
| `admin-manager.module.js` | **BatchManager**。列表状态管理。 |
| `admin-ui.module.js` | **SaveButton**。保存条 UI。 |
| `admin-button-helper.module.js`| **按钮助手**。自动化按钮渲染引擎。 |
| `admin-modal.module.js` | **通用弹窗**。表单编辑弹窗。 |
| `api-client.module.js` | **API 客户端**。Fetch 封装。 |
| `data-provider.module.js` | **数据提供者**。标准化 Data Fetching 接口。 |

---

## 5. 数据与配置 (data & config)

| 文件名 | 描述 |
| :--- | :--- |
| `custom/config.js` | **全局配置**。前端环境常量。 |
| `data/notes/` | **笔记正文**。存储所有 Notes 模块的 `.md` 源文件。 |
| `data/literature/`| **文学正文**。存储所有 Literature 模块的 `.md` 源文件。 |
| `data/record/` | **记录正文**。存储所有 Record 模块的 `.md` 源文件。 |
| `data/games/` | **游戏正文**。存储所有 Games 模块的 `.md` 源文件。 |
| `data/space-tree.json`| **Space 数据**。空间模块的树状结构数据。 |
| `data/notes-tree.json`| **Notes 结构**。笔记模块的树状索引（不含正文）。 |
| `data/games-tree.json`| **Games 结构**。游戏模块的树状索引（不含正文）。 |
| `data/index-cards.json`| **首页配置**。首页卡片数据。 |
| `data/admin-portal.json`| **门户配置**。定义管理门户的模块卡片。 |
| `data/album-config.json`| **相册配置**。定义相册分类、图标与排序规则。 |
| `data/photos-data.json`| **图库数据**。存储所有图片的路径、标签与元数据。 |
| `data/tags/` | **标签配置**。存储各模块的标签分类配置 (JSON)。 |
| `data/tags/cms-*.json` | **标签配置**。`2KB~5KB` (建议单文件标签数 < 200 个)。 |

### 5.1 数据规模建议 (Recommended Limits)
为确保系统在浏览器端的极致性能，请遵循以下数据规模建议。超过此阈值虽不一定会崩溃，但可能会导致首屏加载变慢或交互卡顿。

| 数据类型 | 推荐上限 | 说明 |
| :--- | :--- | :--- |
| **JSON索引文件** (`*-tree.json`) | **< 500KB** | 约等于 2000 个节点。若超过此体积，需考虑开启后端分页或按年归档。 |
| **图库数据** (`photos-data.json`) | **< 3MB** | 约等于 5000 张图片。如需管理海量图片，建议拆分多个 `gallery.db` 实例。 |
| **音乐数据** (`music-data.json`) | **< 1MB** | 约等于 1000 首单曲。 |
| **Markdown 单文件** | **< 50KB** | 纯文本约 2 万字。过大的文件会增加渲染耗时。 |
| **图片单文件** | **< 5MB** | 后端虽然会自动生成缩略图，但原图过大仍会占用服务器存储与带宽。 |
| **标签分类** | **< 50 个/每模块** | 过多的标签分类会使筛选器 UI 变得拥挤难用。 |
