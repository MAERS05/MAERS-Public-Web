# MAERS - Personal Web Ecosystem

MAERS 是一个追求极致轻量、原生体验的个人数字花园生态系统。它集成了博客内容管理 (CMS)、数字相册、音乐播放器和个人档案于一体，完全基于原生 Web 技术构建。

---

## 📋 目录 (Table of Contents)

1. [项目简介](#1-项目简介)
2. [核心功能](#2-核心功能)
3. [技术架构](#3-技术架构)
4. [详细目录结构](#4-详细目录结构)
5. [运行与部署](#5-运行与部署)
6. [管理员指南](#6-管理员指南)

---

## 1. 项目简介

MAERS 旨在解决现代前端开发日益臃肿的问题。它摒弃了 React/Vue 等重型框架，回归 Web 本源。

- **哲学**: Write Less, Do More. Zero Dependencies.
- **目标**: 提供一个既能作为极速静态网站展示，又能作为强大 CMS 管理内容的双模系统。
- **状态**: 2026-02-02 已完成深度架构重构 (v3.1 - Pure ES6 Modules)。

---

## 2. 核心功能

### 📝 CMS (内容管理系统)
- **双模渲染**: 访客端静态渲染 Markdown，管理端所见即所得 (WYSIWYG) 编辑。
- **层级管理**: 支持无限层级的文件夹结构的笔记整理。
- **拖拽排序**: 文件夹和文件支持直观的拖拽排序。
- **标签系统**: 强大的标签过滤与分类检索。

### 🖼️ Album (相册)
- **瀑布流布局**: 自适应多列瀑布流展示。
- **高性能灯箱**: 支持缩放、平移、键盘导航的沉浸式图片查看器。
- **多级存储**: 自动生成 AVIF (高清预览) 和 WebP (列表缩略) 格式。

### 🎵 Music (音乐播放器)
- **全局吸底**: 页面跳转不中断播放（状态持久化）。
- **画中画 (PiP)**: 支持悬浮窗歌词显示。
- **可视化**: 基于 Canvas 的音频频谱可视化。

### 📚 Literature (文学)
- **Flow Engine (流动引擎)**: 独特的 3D 流动路径交互，模拟书架漫游体验。
- **虚拟滚动**: 支持海量书籍流畅渲染的 Virtual Scrolling 技术。
- **沉浸阅读**: 专注的 Markdown 阅读器，支持全屏沉浸模式与标签过滤。

### 🎨 Theme (主题系统)
- **智能深色模式**: 根据系统设置或时间自动切换。
- **防闪烁 (Flash Guard)**: 独特的同步加载策略，彻底消除 FOUC。
- **缩放视图**: 支持全局 UI 缩放 (Shrink Mode)。

### 🚀 Deployment (部署与更新)
- **静态部署**: 原生支持 GitHub Pages / Vercel / Netlify 纯静态部署。
- **自动版本控制**: 内置 Service Worker 自动更新机制。只需修改 `maers-version-controller.js` 版本号，即可穿透 CDN 强制全站更新，告别手动清缓存。

---

## 3. 技术架构

### 前端 (Frontend)
- **语言**: ES6+ JavaScript (Modules `import/export`)
- **架构**: **Zero Global Pollution** (业务逻辑零全局挂载) + Dependency Injection (依赖注入)
- **样式**: CSS3 Variables, Grid, Flexbox (BEM 命名规范)
- **数据**: Fetch API + JSON
- **无构建**: 无 Webpack/Vite，直接运行源代码。

### 后端 (Backend - Admin Only)
- **语言**: Python 3.8+
- **核心**: `_studio/` 目录下的 Python 引擎
- **框架**: Flask (路由分发)
- **数据库**: SQLite (`cms.db`, `gallery.db`)

---

## 4. 详细目录结构

```text
/
├── _studio/                    # 🧠 后端核心引擎 (Control Center)
│   ├── server.py               #   ├── Flask 服务器入口
│   ├── routes.py               #   ├── API 路由定义
│   ├── services/               #   ├── 业务逻辑服务层 (File/DB)
│   └── *.bat                   #   └── 快捷管理脚本
├── _说明/                      # 📚 项目核心文档中心
├── custom/                     # 🔴 前端业务模块 (ES6 Modules)
│   ├── album/                  #   ├── 相册模块
│   ├── cms/                    #   ├── CMS 核心模块
│   ├── literature/             #   ├── 文学模块 (Flow Engine)
│   ├── music/                  #   ├── 音乐模块
│   └── ...                     #   └── 其他功能模块
├── data/                       # 🔵 数据源
│   ├── cms.db                  #   ├── CMS 数据库 (Notes/Literature/Record)
│   ├── gallery.db              #   ├── 相册数据库
│   └── *.json                  #   └── 静态导出的 JSON 数据
├── data-manage/                # 💾 前端数据层
│   └── api-client.module.js    #   └── 统一 API 客户端 (Fetch封装)
├── dynamic-style/              # 🟡 关键渲染脚本
│   └── flash-guard.js          #   └── [Critical] 同步防闪烁脚本
├── photos/                     # 🖼️ 图片仓库
├── plugins/                    # 🔌 第三方依赖
├── shared/                     # 🧩 全局共享逻辑
├── static-style/               # 🟢 全局静态样式
├── maers-version-controller.js # 🎮 全站版本与缓存控制器 (Service Worker)
└── *.html                      # 🌐 页面入口
```

---

## 5. 运行与部署

### 5.1 访客模式 (Viewer Mode)
只需静态 HTTP 服务器即可运行。

### 5.2 管理模式 (Admin Mode)
这是 MAERS 的完全体，必须启动 `_studio` 引擎。

1. **安装依赖**:
   ```bash
   pip install flask pillow
   ```
2. **启动引擎**:
   - **方式 A (推荐)**: 双击 `_studio/管理后台.bat`。
   - **方式 B (命令行)**: `python _studio/server.py` (这会调用 `_studio` 中的逻辑)。

---

## 6. 管理员指南

### 快捷脚本
在 `_studio/` 目录下提供了一系列批处理工具：
- `启动管理后台(server.py).bat`: 一键启动 Python 服务并打开浏览器。
- `清理垃圾数据(clean-data.py).bat`: 扫描并清理数据库中不存在的图片、孤儿文件和无效记录。
- `清空所有数据(wipe-data.py).bat`: **危险操作**。一键抹除所有用户数据，将系统恢复至初始安装状态。
- `快捷打开文件(open-file.py).bat`: 快速定位到内容所在的物理路径。

### 核心操作
- **内容编辑**: 访问 `/admin-cms.html`，所有数据变更会通过 `api-client` 发送给 `_studio/routes.py` 处理。
- **数据同步**: 编辑操作会自动触发 SQLite 写入，并由 `services/` 层自动更新 `data/*.json` 静态文件。
